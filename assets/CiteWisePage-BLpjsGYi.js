import{l as L,u as J,q as B,m as R,r as p,F as W,j as t,Q as S,c as g,t as F,a as G}from"./index-Cf9C7PVC.js";import{S as N}from"./Select-COm5afdw.js";import{I as d}from"./Input-gw2yEWz2.js";import{C as f}from"./Card-C8Vt2KLr.js";import{g as E,p as M}from"./geminiService-DJIPhCmJ.js";import{d as _}from"./downloadHelper-Y0t7dfPR.js";const k={authors:"",title:"",year:"",sourceType:"Journal Article",urlOrDoi:"",publisherOrJournal:"",volumeIssuePages:""},z=[{value:"Journal Article",label:"Journal Article"},{value:"Book",label:"Book"},{value:"Book Chapter",label:"Book Chapter"},{value:"Website",label:"Website / Webpage"},{value:"Conference Paper",label:"Conference Paper"},{value:"Thesis/Dissertation",label:"Thesis / Dissertation"},{value:"Report",label:"Report"},{value:"Other",label:"Other"}],K=()=>{const{settings:i,updateSettings:T}=L(),{t:e}=J(),{addToast:r}=B(),{openSaveToDriveModal:w}=R(),[a,y]=p.useState(k),[l,h]=p.useState(""),[n,C]=p.useState(!1),[b,x]=p.useState(null),P=Object.values(W).map(s=>({value:s,label:e(`settings.formattingStyles.${s.toLowerCase().replace(/\s+/g,"")}`)})),c=s=>{const{name:u,value:m}=s.target;y(o=>({...o,[u]:m}))},D=p.useCallback(async()=>{if(!a.authors.trim()||!a.title.trim()||!a.year.trim()){r(e("citeWise.fieldsRequired"),"warning");return}C(!0),x(null),h("");let s=`Authors: ${a.authors}
Title: ${a.title}
Year: ${a.year}
Source Type: ${a.sourceType}`;a.urlOrDoi.trim()&&(s+=`
URL/DOI: ${a.urlOrDoi}`),a.publisherOrJournal.trim()&&(s+=`
Publisher/Journal: ${a.publisherOrJournal}`),a.volumeIssuePages.trim()&&(s+=`
Volume/Issue/Pages: ${a.volumeIssuePages}`);let u=`Generate a citation in ${i.formattingStyle} style for the following academic source:`;i.formattingStyle===W.NIGERIAN_ACADEMIC_APA&&i.geographicRegion==="Nigeria"&&(u="Generate a citation strictly adhering to Nigerian Academic APA style (which is APA style with potential nuances for citing local Nigerian authors or government publications, ensuring names are fully spelled out if common practice). Use the following source details:");const m=`${u}
${s}

Output ONLY a valid JSON object with a single key: "citation", which holds the formatted citation string. Do not include any extra text, labels, or explanations before or after the JSON.`,o=await E("",{...i,responseMimeType:"application/json",customPromptOverride:m});if(o.error)x(o.error),r(o.error,"error");else{const v=M(o.text);v&&typeof v.citation=="string"?(h(v.citation),r(e("citeWise.generationSuccess",{style:i.formattingStyle}),"success")):o.text.trim().length>10?(h(o.text.trim()),r(e("citeWise.generationSuccess",{style:i.formattingStyle}),"success")):(x("AI returned data in an unexpected format. Could not parse citation."),r("Failed to parse citation from AI response.","error"))}C(!1)},[a,i,r,e]),j=(s,u)=>{const m=s.replace(/[^\w\s-]/gi,"").replace(/\s+/g,"_")||"Citation";return`${G} - CiteWise - ${m}.${u}`},A=()=>{if(!l){r(e("global.noContentToCopy"),"info");return}navigator.clipboard.writeText(l),r(e("global.copiedToClipboard"),"success")},O=()=>{if(!l){r(e("global.noContentToDownload"),"info");return}const s=j(a.title,"txt");_(l,s),r(e("global.downloadInitiated"),"success")},I=()=>{if(!l){r(e("global.noContentToSave"),"info");return}const s=j(a.title,"txt");w(l,s)},$=()=>{y(k),h(""),x(null),r(e("citeWise.fieldsCleared"),"info")};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("header",{className:"pb-4",children:[t.jsxs("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight text-foreground dark:text-dark-foreground flex items-center",children:[t.jsx(S,{className:"h-7 w-7 md:h-8 md:w-8 mr-2 text-primary dark:text-dark-primary"}),e("citeWise.title")]}),t.jsx("p",{className:"mt-1 text-muted-foreground dark:text-dark-muted-foreground",children:e("citeWise.description")})]}),t.jsxs(f,{title:e("citeWise.sourceDetailsTitle"),children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[t.jsx(d,{label:e("citeWise.authorsLabel"),name:"authors",value:a.authors,onChange:c,placeholder:e("citeWise.authorsPlaceholder")}),t.jsx(d,{label:e("citeWise.titleLabel"),name:"title",value:a.title,onChange:c,placeholder:e("citeWise.titlePlaceholder")}),t.jsx(d,{label:e("citeWise.yearLabel"),name:"year",type:"number",value:a.year,onChange:c,placeholder:e("citeWise.yearPlaceholder")}),t.jsx(N,{label:e("citeWise.sourceTypeLabel"),name:"sourceType",options:z,value:a.sourceType,onChange:c}),t.jsx(d,{label:e("citeWise.publisherLabel"),name:"publisherOrJournal",value:a.publisherOrJournal,onChange:c,placeholder:e("citeWise.publisherPlaceholder")}),t.jsx(d,{label:e("citeWise.volumeLabel"),name:"volumeIssuePages",value:a.volumeIssuePages,onChange:c,placeholder:e("citeWise.volumePlaceholder")}),t.jsx(d,{label:e("citeWise.urlLabel"),name:"urlOrDoi",value:a.urlOrDoi,onChange:c,placeholder:e("citeWise.urlPlaceholder"),containerClassName:"md:col-span-2"}),t.jsx(N,{label:e("citeWise.styleLabel"),name:"formattingStyle",options:P,value:i.formattingStyle,onChange:s=>T({formattingStyle:s.target.value}),containerClassName:"md:col-span-2"})]}),t.jsxs("div",{className:"mt-6 flex flex-wrap gap-2 justify-end",children:[t.jsx(g,{onClick:$,variant:"outline",disabled:n,className:"w-full sm:w-auto",children:e("global.clearAllFields")}),t.jsx(g,{onClick:D,isLoading:n,disabled:!a.authors||!a.title||!a.year,className:"w-full sm:w-auto",children:e("citeWise.generateButton")})]})]}),t.jsxs("div",{"aria-live":"polite","aria-busy":n,children:[n&&t.jsx(F,{text:e("global.loading")}),b&&!n&&t.jsxs(f,{className:"bg-destructive/10 border-destructive text-destructive-foreground dark:bg-destructive/20 dark:text-destructive",children:[t.jsx("p",{className:"font-semibold",children:e("global.error")}),t.jsx("p",{className:"text-sm",children:b})]}),!n&&!l&&!b&&t.jsx(f,{children:t.jsxs("div",{className:"text-center py-10 text-muted-foreground dark:text-dark-muted-foreground",children:[t.jsx(S,{className:"h-16 w-16 mx-auto text-primary/30 dark:text-dark-primary/30 mb-4"}),t.jsx("p",{className:"font-semibold text-lg",children:e("citeWise.readyTitle")}),t.jsx("p",{className:"text-sm",children:e("citeWise.readyDescription")})]})}),!n&&l&&t.jsxs(f,{title:e("citeWise.generatedTitle",{style:i.formattingStyle}),children:[t.jsx("div",{className:"p-3 bg-muted/50 dark:bg-dark-muted/30 rounded-md",children:t.jsx("p",{className:"text-sm text-foreground dark:text-dark-foreground whitespace-pre-wrap font-mono","aria-label":"Generated citation text",children:l})}),t.jsxs("div",{className:"mt-4 flex flex-wrap gap-2 justify-end",children:[t.jsx(g,{onClick:A,variant:"outline",size:"sm",children:e("citeWise.copyButton")}),t.jsx(g,{onClick:O,variant:"outline",size:"sm",children:e("citeWise.downloadButton")}),t.jsx(g,{onClick:I,variant:"outline",size:"sm",children:e("citeWise.saveToDriveButton")})]})]})]})]})};export{K as default};
