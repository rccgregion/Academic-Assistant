import{l as E,q as P,m as M,r as u,j as e,d as $,c as m,t as J,a as V}from"./index-DwfKsHWR.js";import{I as q}from"./Input-CaI1NqfY.js";import{C as v}from"./Card-BP-gc27O.js";import{g as B,p as K}from"./geminiService-BkXzVexN.js";import{d as L}from"./downloadHelper-Y0t7dfPR.js";function X(){const{settings:N}=E(),{addToast:n}=P(),{openSaveToDriveModal:R}=M(),[a,j]=u.useState(""),[r,p]=u.useState(null),[h,y]=u.useState([]),[d,w]=u.useState(!1),[b,x]=u.useState(null),[l,S]=u.useState(null),I=u.useCallback(async t=>{if(!a.trim()){x("Please enter a research topic or question."),n("Topic is required.","warning");return}w(!0),x(null),t||(p(null),y([])),S(t||null);let i=`Given the research topic: "${a}"`;t&&(i+=`
Specifically, elaborate and dig deeper on the following aspect: "${t}". Integrate this focus into your broader analysis of "${a}".`);const o=`${i}

Perform a comprehensive literature search using your available tools. Based on the most relevant academic sources, synthesize the information and provide a structured analysis.

Format your entire response as a single, valid JSON object with the following keys and value types:
- "overallSummary": (String) A synthesized, comprehensive summary of the current state of research on this topic (or the focused aspect), integrating findings from multiple sources. This should be about 300-400 words.
- "keyThemes": (Array of Strings) A list of 3-5 dominant themes or core arguments found across the literature related to the topic/focus.
- "contrastingViewpoints": (Array of Strings, optional) A list of 2-3 significant contrasting findings, debates, or alternative perspectives identified. If none are prominent, this can be an empty array or omitted.
- "commonMethodologies": (Array of Strings) A list of 2-4 research methodologies frequently employed.
- "identifiedGaps": (Array of Strings) A list of 2-4 specific research gaps explicitly mentioned or strongly implied.
- "futureDirections": (Array of Strings, optional) A list of 1-3 potential future research directions suggested. If none are prominent, this can be an empty array or omitted.

Ensure the JSON is well-formed. Do not include any introductory or concluding text outside of the JSON object itself.`,s=await B("",{...N,useGrounding:!0,customPromptOverride:o});if(s.error)x(s.error),n(s.error,"error");else{const c=K(s.text);c?(p(c),s.sources&&s.sources.length>0&&y(s.sources),n(t?`Deeper insights for "${t}" woven!`:"Insights woven successfully!","success")):(x("AI returned data in an unexpected format. Could not parse insights. Displaying raw output if available."),n("Failed to parse AI response into structured insights.","error"),p({overallSummary:`Raw AI Output (JSON parsing failed):
`+s.text,keyThemes:[],commonMethodologies:[],identifiedGaps:[],rawAIResponse:s.text}))}w(!1)},[a,N,n]),D=t=>{I(t)},A=(t,i,o="Not specified.")=>!t||t.length===0?e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:o}):e.jsx("ul",{className:"space-y-1.5 text-sm",children:t.map((s,c)=>e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"text-muted-foreground dark:text-dark-muted-foreground mr-2",children:"•"}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>D(s),className:"text-left justify-start p-1 h-auto hover:bg-primary/10 dark:hover:bg-dark-primary/10 text-muted-foreground dark:text-dark-muted-foreground hover:text-primary dark:hover:text-dark-primary",title:`Dig deeper into: ${s}`,children:s})]},c))}),g=(t,i,o="Not specified.")=>!t||t.length===0?`${i}: ${o}
`:`${i}:
${t.map(s=>`- ${s}`).join(`
`)}
`,T=(t,i,o)=>{if(!t)return"No insights data available.";let s=`InsightWeaver Report for Topic: ${a}
`;return l&&(s+=`Focused on: ${l}
`),s+=`=========================================

`,s+=`Overall Summary:
${t.overallSummary||"Not provided."}

`,s+=g(t.keyThemes,"Key Themes"),s+=g(t.contrastingViewpoints,"Contrasting Viewpoints","None highlighted."),s+=g(t.commonMethodologies,"Common Methodologies","Not specified."),s+=g(t.identifiedGaps,"Identified Research Gaps","None identified."),s+=g(t.futureDirections,"Suggested Future Research","None suggested."),i.length>0?(s+=`
Key Sources Used:
`,i.forEach((c,z)=>{const f=c.web||c.retrievedContext;f&&f.uri&&(s+=`${z+1}. ${f.title||f.uri} (${f.uri})
`)})):s+=`
No specific web sources were cited by the AI for this synthesis.
`,o&&(s+=`

--- Raw AI Response (JSON Parsing Failed) ---
${o}`),s},C=(t,i)=>{const o=t.replace(/[^\w\s-]/gi,"").replace(/\s+/g,"_")||"Insights";return`${V} - InsightWeaver - ${o}.${i}`},F=()=>{if(!r){n("No insights to download.","info");return}const t=T(r,h,r.rawAIResponse||null),i=C(a,"txt");L(t,i),n("Insights download initiated.","success")},W=()=>{if(!r){n("No insights to save.","info");return}const t=T(r,h,r.rawAIResponse||null),i=C(a,"txt");R(t,i)},k=(t,i="Not specified.")=>!t||t.length===0?e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:i}):e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground dark:text-dark-muted-foreground",children:t.map((o,s)=>e.jsx("li",{children:o},s))}),G=()=>{j(""),p(null),y([]),x(null),S(null),n("Topic and insights cleared.","info")},O=l?`Digging deeper into "${l}"...`:"Weaving insights from academic sources...";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"pb-4",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight text-foreground dark:text-dark-foreground flex items-center",children:[e.jsx($,{className:"h-7 w-7 md:h-8 md:w-8 mr-2 text-primary dark:text-dark-primary"}),"InsightWeaver"]}),e.jsx("p",{className:"mt-1 text-muted-foreground dark:text-dark-muted-foreground",children:"AI-Powered Research Synthesis: Uncover themes, gaps, and connections in academic literature."})]}),e.jsx(v,{title:"Define Your Research Area",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(q,{label:"Research Topic / Question",id:"researchTopic",placeholder:"e.g., 'The impact of AI on creative industries', 'What are the ethical implications of gene editing?'",value:a,onChange:t=>j(t.target.value)}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-2",children:[(a||r)&&e.jsx(m,{onClick:G,variant:"outline",disabled:d,className:"w-full sm:w-auto",children:"Clear Topic"}),e.jsx(m,{onClick:()=>I(),isLoading:d,disabled:!a.trim(),className:"w-full sm:w-auto",children:l||r?"Re-Weave/Dig Deeper":"Weave Insights"})]})]})}),e.jsxs("div",{"aria-live":"polite","aria-busy":d,children:[d&&e.jsx(J,{text:O}),b&&!d&&e.jsxs(v,{className:"bg-destructive/10 border-destructive text-destructive-foreground dark:bg-destructive/20 dark:text-destructive",children:[e.jsx("p",{className:"font-semibold",children:"Error Weaving Insights"}),e.jsx("p",{className:"text-sm",children:b})]}),!d&&!r&&!b&&!a.trim()&&e.jsx(v,{children:e.jsxs("div",{className:"text-center py-10 text-muted-foreground dark:text-dark-muted-foreground",children:[e.jsx($,{className:"h-16 w-16 mx-auto text-primary/30 dark:text-dark-primary/30 mb-4"}),e.jsx("p",{className:"font-semibold text-lg",children:"Ready to Weave Insights"}),e.jsx("p",{className:"text-sm",children:"Enter your research topic above to begin synthesizing academic literature."})]})}),!d&&r&&e.jsxs(v,{title:l?`Focused Insights: ${l}`:"Synthesized Insights",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-2 mb-4 -mt-2",children:[e.jsx(m,{onClick:F,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:"Download Insights"}),e.jsx(m,{onClick:W,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:"Save Insights to Google Drive"})]}),r.rawAIResponse&&e.jsxs("div",{className:"mb-4 p-3 bg-amber-100 dark:bg-amber-900/30 border border-amber-300 dark:border-amber-700 rounded-md",children:[e.jsx("h4",{className:"font-semibold text-amber-700 dark:text-amber-300",children:"Note: Parsing Error"}),e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"The AI's response could not be fully parsed into a structured format. Displaying raw output below for review. This might happen if the AI didn't strictly adhere to the requested JSON structure."}),e.jsx("pre",{className:"mt-2 text-xs whitespace-pre-wrap bg-white/50 dark:bg-black/20 p-2 rounded",children:r.rawAIResponse})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-1.5 text-foreground dark:text-dark-foreground",children:"Overall Summary"}),e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground whitespace-pre-line",children:r.overallSummary||"Summary not provided."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-1.5 text-foreground dark:text-dark-foreground",children:"Key Themes (Click to Dig Deeper)"}),A(r.keyThemes,"theme","No key themes identified.")]}),r.contrastingViewpoints&&r.contrastingViewpoints.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-1.5 text-foreground dark:text-dark-foreground",children:"Contrasting Viewpoints"}),k(r.contrastingViewpoints,"No contrasting viewpoints highlighted.")]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-1.5 text-foreground dark:text-dark-foreground",children:"Common Methodologies"}),k(r.commonMethodologies,"Not specified.")]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-1.5 text-foreground dark:text-dark-foreground",children:"Identified Research Gaps"}),A(r.identifiedGaps,"gap","No research gaps identified.")]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-1.5 text-foreground dark:text-dark-foreground",children:"Suggested Future Research"}),k(r.futureDirections,"None suggested.")]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Key Sources"}),h&&h.length>0?e.jsx("ul",{className:"list-disc list-inside text-sm text-muted-foreground dark:text-dark-muted-foreground space-y-1",children:h.map((t,i)=>{var o;return e.jsx("li",{children:t.web&&t.web.title||t.retrievedContext&&t.retrievedContext.title||((o=t.web)==null?void 0:o.uri)||"Source"},i)})}):e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:"No specific web sources were cited by the AI for this synthesis."})]}),e.jsx("div",{className:"pt-2 flex justify-end",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground dark:text-dark-muted-foreground mr-1",children:"Helpful?"}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{n("Feedback recorded (mock).","info")},className:"p-1 text-muted-foreground hover:text-primary",children:"👍"}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{n("Feedback recorded (mock).","info")},className:"p-1 text-muted-foreground hover:text-destructive",children:"👎"})]})})]})]})]})]})}export{X as default};
