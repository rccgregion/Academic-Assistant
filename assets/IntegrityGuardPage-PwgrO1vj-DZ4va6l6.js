import{f as z,h as G,p as O,y as M,m as E,v as l,u as e,c as w,a as c,l as P,R as D,d as F}from"./index-CL7HjhdV.js";import{b as g}from"./Card-C8Vt2KLr-CXW7Tvcj.js";import{a as J,c as L}from"./geminiService-DJIPhCmJ-Bm2owfCC.js";import{c as Y}from"./downloadHelper-Y0t7dfPR--lPmL3re.js";const _=()=>{const{settings:x}=z(),d=G(),j=O(),{addToast:s}=M(),{openSaveToDriveModal:N}=E(),[o,h]=l.useState(""),[a,m]=l.useState(null),[n,p]=l.useState(!1),[f,u]=l.useState(null),[y,v]=l.useState(void 0);l.useEffect(()=>{var t;if((t=d.state)!=null&&t.initialText){h(d.state.initialText);const r=d.state.documentName?` from "${d.state.documentName}"`:"";v(d.state.documentName),s(`Text loaded${r} into IntegrityGuard.`,"info"),window.history.replaceState({},document.title)}},[d.state,s]);const T=l.useCallback(async()=>{if(!o.trim()){s("Input text is empty. Please enter text to analyze.","warning");return}p(!0),u(null),m(null);let t=`Analyze the following text for originality and academic integrity.
Provide a simulated "originality score" between 0 and 100, where 100 is perfectly original.
Identify specific sentences or short phrases (segments) that seem very common, unoriginal, or might require citation if they are not common knowledge or properly attributed. For each segment, provide the text of the segment and a brief suggestion for review.
Provide a brief overall summary message.`;x.geographicRegion==="Nigeria"&&(t+=`
Consider the Nigerian academic context: be aware of common Nigerian academic writing styles or phrases that might be acceptable locally versus those indicating plagiarism, while still upholding global academic integrity standards.`),t+=`
Output the result as a single JSON object with the following keys:
- "overallScore": A number representing the simulated originality score (e.g., 85).
- "segmentsToReview": An array of objects, where each object has:
    - "originalText": The exact text of the segment identified.
    - "suggestion": A brief suggestion (e.g., "This phrase is common, consider rephrasing or citing if specific.", "Review for potential citation.").
- "summaryMessage": A brief overall summary of the findings.

Example of a segment object:
{ "originalText": "The quick brown fox jumps over the lazy dog.", "suggestion": "This is a very common pangram, ensure it's used appropriately." }

Text to Analyze:
"""
${o}
"""

Ensure the output is ONLY a valid JSON object.`;const r=await J("",{...x,responseMimeType:"application/json",customPromptOverride:t});if(r.error)u(r.error),s(r.error,"error");else{const i=L(r.text);i&&typeof i.overallScore=="number"&&Array.isArray(i.segmentsToReview)?(m(i),s("Integrity check complete!","success")):(u("AI returned data in an unexpected format. Could not parse analysis."),s("Failed to parse AI response into structured analysis.","error"),m({overallScore:0,segmentsToReview:[{originalText:"Error parsing response.",suggestion:"AI output was not valid JSON."}],summaryMessage:"Could not retrieve structured analysis from AI."}))}p(!1)},[o,x,s]),S=t=>t>=85?"text-emerald-500 dark:text-emerald-400":t>=60?"text-amber-500 dark:text-amber-400":"text-destructive dark:text-red-500",A=t=>{j("/stealth-writer",{state:{initialText:t,sourceFeatureName:"IntegrityGuard",documentName:y}})},k=t=>{let r=`IntegrityGuard Analysis Report
=============================

`;return r+=`Original Text Analyzed:
-------------------------
${o}

`,r+=`Simulated Originality Score: ${t.overallScore}%
`,r+=`Summary Message: ${t.summaryMessage||"N/A"}

`,t.segmentsToReview.length>0?(r+=`Segments to Review:
---------------------
`,t.segmentsToReview.forEach((i,C)=>{r+=`Segment ${C+1}:
`,r+=`  Text: "${i.originalText}"
`,r+=`  Suggestion: ${i.suggestion}

`})):r+=`No specific segments flagged for review.
`,r},b=(t,r)=>{const i=t.replace(/[^\w\s-]/gi,"").replace(/\s+/g,"_")||"IntegrityReport";return`${F} - IntegrityGuard - ${i}.${r}`},I=()=>{if(!a){s("No analysis to download.","info");return}const t=k(a),r=b(y||"Analysis","txt");Y(t,r),s("Analysis download initiated.","success")},R=()=>{if(!a){s("No analysis to save.","info");return}const t=k(a),r=b(y||"Analysis","txt");N(t,r)},$=()=>{h(""),m(null),u(null),v(void 0),s("Input and analysis cleared.","info")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"pb-4",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight text-foreground dark:text-dark-foreground flex items-center",children:[e.jsx(w,{className:"h-7 w-7 md:h-8 md:w-8 mr-2 text-primary dark:text-dark-primary"}),"IntegrityGuard"]}),e.jsx("p",{className:"mt-1 text-muted-foreground dark:text-dark-muted-foreground",children:"Get a simulated originality check on your text and identify areas that might need review or citation."})]}),e.jsxs(g,{title:"Input Text for Integrity Check",children:[e.jsx("textarea",{value:o,onChange:t=>h(t.target.value),rows:12,className:"w-full p-2.5 border rounded-md focus:ring-2 focus:ring-primary dark:focus:ring-dark-primary focus:border-transparent bg-background dark:bg-dark-input dark:border-dark-border dark:text-dark-foreground dark:placeholder-dark-muted-foreground transition-all",placeholder:"Paste your text here or upload via Document Lab...","aria-label":"Text input for integrity check"}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-2",children:[(o||a)&&e.jsx(c,{onClick:$,variant:"outline",disabled:n,className:"w-full sm:w-auto",children:"Clear All Fields"}),e.jsx(c,{onClick:T,isLoading:n,disabled:!o.trim(),className:"w-full sm:w-auto",children:"Check Integrity"})]})]}),e.jsxs("div",{"aria-live":"polite","aria-busy":n,children:[n&&e.jsx(P,{text:"Guarding integrity by analyzing your text..."}),f&&!n&&e.jsxs(g,{className:"bg-destructive/10 border-destructive text-destructive-foreground dark:bg-destructive/20 dark:text-destructive",children:[e.jsx("p",{className:"font-semibold",children:"Error During Analysis"}),e.jsx("p",{className:"text-sm",children:f})]}),!n&&!a&&!o.trim()&&!f&&e.jsx(g,{children:e.jsxs("div",{className:"text-center py-10 text-muted-foreground dark:text-dark-muted-foreground",children:[e.jsx(w,{className:"h-16 w-16 mx-auto text-primary/30 dark:text-dark-primary/30 mb-4"}),e.jsx("p",{className:"font-semibold text-lg",children:"Ready to Guard Your Integrity"}),e.jsx("p",{className:"text-sm",children:"Paste your text above to begin the analysis for potential originality issues."})]})}),!n&&a&&e.jsxs(g,{title:"Integrity Analysis Results",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-2 mb-4 -mt-2",children:[e.jsx(c,{onClick:I,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:"Download Analysis"}),e.jsx(c,{onClick:R,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:"Save Analysis to Google Drive"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold mb-1 text-foreground dark:text-dark-foreground",children:["Simulated Originality Score:",e.jsxs("span",{className:`ml-2 ${S(a.overallScore)}`,children:[a.overallScore,"%"]})]}),a.summaryMessage&&e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:a.summaryMessage})]}),a.segmentsToReview.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2 text-foreground dark:text-dark-foreground",children:"Segments to Review:"}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:a.segmentsToReview.map((t,r)=>e.jsxs("div",{className:"p-3 border rounded-md bg-muted/50 dark:bg-dark-muted/30 border-border dark:border-dark-border",children:[e.jsxs("p",{className:"text-sm text-foreground dark:text-dark-foreground italic",children:['"',t.originalText,'"']}),e.jsxs("p",{className:"mt-1 text-xs text-primary dark:text-dark-primary font-medium",children:["Suggestion: ",t.suggestion]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>A(t.originalText),className:"text-xs text-secondary dark:text-dark-secondary hover:bg-secondary/10 dark:hover:bg-dark-secondary/20",children:[e.jsx(D,{className:"h-3.5 w-3.5 mr-1.5"}),"Rewrite with StealthWriter"]})})]},r))})]}),a.segmentsToReview.length===0&&a.overallScore>0&&e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:"No specific segments were flagged for review based on the current analysis."})]})]})]})]})};export{_ as default};
