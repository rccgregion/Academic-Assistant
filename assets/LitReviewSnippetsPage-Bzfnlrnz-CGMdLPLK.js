import{f as I,y as E,m as L,v as p,u as e,b as $,a as f,l as z,d as _}from"./index-CL7HjhdV.js";import{a as D}from"./Input-gw2yEWz2-BvFam9MV.js";import{b}from"./Card-C8Vt2KLr-CXW7Tvcj.js";import{a as F,c as O}from"./geminiService-DJIPhCmJ-Bm2owfCC.js";import{c as J}from"./downloadHelper-Y0t7dfPR--lPmL3re.js";const B=()=>{const{settings:N}=I(),{addToast:l}=E(),{openSaveToDriveModal:U}=L(),[o,y]=p.useState(""),[c,g]=p.useState([]),[h,v]=p.useState([]),[u,w]=p.useState(!1),[k,x]=p.useState(null),[n,j]=p.useState(null),A=p.useCallback(async()=>{if(!o.trim()){x("Please enter a research topic or question."),l("Topic is required.","warning");return}w(!0),x(null),g([]),v([]),j(null);const r=`For the research topic: "${o}", find and summarize 3-5 key academic articles or findings using web search grounding.
For each, provide:
1.  "title": The original article title (or a descriptive title for the finding).
2.  "snippetText": A concise summary snippet (2-4 sentences) of its main contribution or finding related to the topic.
3.  "sourceUrl": The primary URL of the source, if available from your search grounding.
4.  "sourceTitle": The title of the webpage/document at the sourceUrl, if available from your search grounding.

Format the output as a single JSON array of objects, where each object has these four keys.
Ensure the JSON is valid. Do not include any introductory or concluding text outside of the JSON object itself.`,t=await F("",{...N,useGrounding:!0,customPromptOverride:r});if(t.error)x(t.error),l(t.error,"error");else{t.sources&&t.sources.length>0&&v(t.sources);const a=O(t.text);if(a&&Array.isArray(a)){const i=a.map((s,m)=>{if((!s.sourceUrl||!s.sourceTitle)&&t.sources&&t.sources[m]){const d=t.sources[m].web||t.sources[m].retrievedContext;return{...s,sourceUrl:s.sourceUrl||(d==null?void 0:d.uri),sourceTitle:s.sourceTitle||(d==null?void 0:d.title)}}return s});g(i),l(`Generated ${i.length} literature snippets!`,"success")}else x("AI returned data in an unexpected format. Could not parse snippets. Raw response available for download."),l("Failed to parse AI response into structured snippets.","error"),j(t.text)}w(!1)},[o,N,l]),S=(r,t,a)=>{let i=`Literature Review Snippets for Topic: ${o}
`;return i+=`==============================================

`,r.length>0?r.forEach((s,m)=>{i+=`Snippet ${m+1}:
`,i+=`  Title: ${s.title||"N/A"}
`,i+=`  Snippet: ${s.snippetText||"N/A"}
`,s.sourceUrl&&(i+=`  Source: ${s.sourceTitle||s.sourceUrl} (${s.sourceUrl})
`),i+=`----------------------------------------------

`}):a?i+=`Could not parse snippets. Raw AI response:
${a}

`:i+=`No snippets were generated or parsed.

`,t.length>0&&!r.some(s=>s.sourceUrl)&&(i+=`
Grounding Sources Retrieved by AI:
`,t.forEach((s,m)=>{const d=s.web||s.retrievedContext;d&&d.uri&&(i+=`${m+1}. ${d.title||d.uri} (${d.uri})
`)})),i},T=(r,t)=>{const a=r.replace(/[^\w\s-]/gi,"").replace(/\s+/g,"_")||"LitReview";return`${_}_LitReviewSnippets_${a}.${t}`},R=()=>{if(c.length===0&&!n){l("No snippets to download.","info");return}const r=S(c,h,n),t=T(o,"txt");J(r,t),l("Snippets download initiated.","success")},C=()=>{if(c.length===0&&!n){l("No snippets to save.","info");return}const r=S(c,h,n),t=T(o,"txt");U(r,t)},G=()=>{y(""),g([]),v([]),x(null),j(null),l("Topic and snippets cleared.","info")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"pb-4",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight text-foreground dark:text-dark-foreground flex items-center",children:[e.jsx($,{className:"h-7 w-7 md:h-8 md:w-8 mr-2 text-primary dark:text-dark-primary"}),"LitReview Snippets"]}),e.jsx("p",{className:"mt-1 text-muted-foreground dark:text-dark-muted-foreground",children:"Get AI-generated summary snippets from relevant academic sources for your research topic."})]}),e.jsx(b,{title:"Enter Your Research Topic",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(D,{label:"Research Topic or Sub-Theme",id:"researchTopic",placeholder:"e.g., 'AI in personalized medicine', 'Sustainable urban development in Africa'",value:o,onChange:r=>y(r.target.value)}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-2",children:[(o||c.length>0||n)&&e.jsx(f,{onClick:G,variant:"outline",disabled:u,className:"w-full sm:w-auto",children:"Clear All"}),e.jsx(f,{onClick:A,isLoading:u,disabled:!o.trim(),className:"w-full sm:w-auto",children:"Generate Snippets"})]})]})}),e.jsxs("div",{"aria-live":"polite","aria-busy":u,children:[u&&e.jsx(z,{text:"Searching and synthesizing literature snippets..."}),k&&!u&&e.jsxs(b,{className:"bg-destructive/10 border-destructive text-destructive-foreground dark:bg-destructive/20 dark:text-destructive",children:[e.jsx("p",{className:"font-semibold",children:"Error Generating Snippets"}),e.jsx("p",{className:"text-sm",children:k})]}),!u&&c.length===0&&!k&&!o.trim()&&!n&&e.jsx(b,{children:e.jsxs("div",{className:"text-center py-10 text-muted-foreground dark:text-dark-muted-foreground",children:[e.jsx($,{className:"h-16 w-16 mx-auto text-primary/30 dark:text-dark-primary/30 mb-4"}),e.jsx("p",{className:"font-semibold text-lg",children:"Ready for Literature Insights"}),e.jsx("p",{className:"text-sm",children:"Enter your research topic above to get started."})]})}),!u&&(c.length>0||n)&&e.jsxs(b,{title:"Generated Literature Snippets",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-2 mb-4 -mt-2",children:[e.jsx(f,{onClick:R,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:"Download Snippets"}),e.jsx(f,{onClick:C,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:"Save Snippets to Google Drive"})]}),n&&e.jsxs("div",{className:"mb-4 p-3 bg-amber-100 dark:bg-amber-900/30 border border-amber-300 dark:border-amber-700 rounded-md",children:[e.jsx("h4",{className:"font-semibold text-amber-700 dark:text-amber-300",children:"Note: Parsing Error"}),e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Raw AI response:"}),e.jsx("pre",{className:"mt-2 text-xs whitespace-pre-wrap bg-white/50 dark:bg-black/20 p-2 rounded",children:n})]}),e.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:c.map((r,t)=>e.jsxs("div",{className:"p-4 border border-border dark:border-dark-border rounded-md bg-muted/30 dark:bg-dark-muted/30",children:[e.jsx("h4",{className:"text-md font-semibold text-foreground dark:text-dark-foreground mb-1",children:r.title||"Untitled Snippet"}),e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground whitespace-pre-line",children:r.snippetText}),r.sourceUrl&&e.jsx("div",{className:"mt-2 pt-2 border-t border-border/30 dark:border-dark-border/30",children:e.jsxs("p",{className:"text-xs font-medium text-muted-foreground dark:text-dark-muted-foreground",children:["Source:",e.jsx("a",{href:r.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"ml-1 text-primary hover:underline dark:text-dark-primary break-all",title:r.sourceUrl,children:r.sourceTitle||r.sourceUrl})]})})]},t))}),h.length>0&&!c.some(r=>r.sourceUrl)&&!n&&e.jsxs("div",{className:"pt-3 mt-4 border-t border-border dark:border-dark-border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-1.5 text-foreground dark:text-dark-foreground",children:"Grounding Sources Retrieved by AI:"}),e.jsx("ul",{className:"list-decimal list-inside space-y-1.5 text-sm",children:h.map((r,t)=>{const a=r.web||r.retrievedContext;return!a||!a.uri?null:e.jsx("li",{className:"text-muted-foreground dark:text-dark-muted-foreground",children:e.jsx("a",{href:a.uri,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline dark:text-dark-primary break-all",title:a.uri,children:a.title||a.uri})},`ground-source-${t}`)})})]})]})]})]})};export{B as default};
