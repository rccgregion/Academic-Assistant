import{f as J,h as Y,y as K,m as H,v as o,u as e,e as C,a as m,l as w,B as V,d as _}from"./index-CL7HjhdV.js";import{b as h}from"./Card-C8Vt2KLr-CXW7Tvcj.js";import{a as O,c as q}from"./geminiService-DJIPhCmJ-Bm2owfCC.js";import{c as Q}from"./downloadHelper-Y0t7dfPR--lPmL3re.js";import{o as U,v as W}from"./ThumbsDownIcon-DnGwiL1i-BMCEM19-.js";const re=()=>{const{settings:k}=J(),n=Y(),{addToast:a}=K(),{openSaveToDriveModal:T}=H(),[l,j]=o.useState(""),[i,f]=o.useState(null),[c,$]=o.useState(!1),[b,u]=o.useState(null),[A,P]=o.useState(void 0),[g,p]=o.useState(null),[y,S]=o.useState(!1),[x,v]=o.useState(null);o.useEffect(()=>{var t;if((t=n.state)!=null&&t.initialText){j(n.state.initialText),n.state.documentName&&P(n.state.documentName);const s=n.state.documentName?` from "${n.state.documentName}"`:"",r=n.state.sourceFeatureName?` from ${n.state.sourceFeatureName}`:"";a(`Text loaded${r}${s} into Paper Analyzer.`,"info"),window.history.replaceState({},document.title)}},[n.state,a]);const G=o.useCallback(async()=>{if(!l.trim()){u("Please paste the text of the research paper to analyze."),a("Please paste paper text.","warning");return}$(!0),u(null),f(null),p(null),v(null);const t=`You are an expert academic paper analyzer. Analyze the following research paper text.
Please provide a structured analysis in JSON format with the following keys:
- "summary": A concise summary of the paper (around 200-300 words), covering purpose, methods, key findings, and conclusions.
- "keyFindings": A bulleted list of the main findings or results (3-5 key points). If providing a list, use an array of strings.
- "methodology": A brief description of the methodology used in the research (1-2 paragraphs), including design, participants/sample, and data collection tools/procedures.
- "limitations": A bulleted list of limitations identified by the authors or apparent from the text (2-4 key points). If providing a list, use an array of strings.
- "identifiedGaps": A bulleted list or a short paragraph describing any research gaps explicitly mentioned or strongly implied by the authors that their research addresses or that remain. If providing a list, use an array of strings. If none clearly identified, state so.
- "suggestedFutureResearch": Based on the paper's findings and limitations, suggest 1-2 potential avenues for future research. If providing a list, use an array of strings.

Ensure the output is ONLY a valid JSON object. Do not include any explanatory text before or after the JSON.

Paper Text:
"""
${l}
"""`,s=await O("",{...k,responseMimeType:"application/json",customPromptOverride:t});if(s.error)u(s.error),a(s.error,"error");else{const r=q(s.text);r?(f(r),a("Paper analysis complete with detailed insights!","success")):(u("AI returned data in an unexpected format. Could not parse analysis. Displaying raw output if available."),a("Failed to parse AI response into structured analysis.","error"),f({summary:`Raw AI Output (JSON parsing failed):
`+s.text,keyFindings:[],methodology:"",limitations:[],identifiedGaps:"Could not parse from AI response.",suggestedFutureResearch:"Could not parse from AI response."}))}$(!1)},[l,k,a]),E=async t=>{if(!l.trim()){a("Original paper text is missing for elaboration.","warning");return}S(!0),v(t),p(null);const s=`Based on the original paper text provided below, please elaborate on the following specific point: "${t}". Provide a more detailed explanation, context, or implications related to this point as found in or directly derivable from the paper.
    Output only the elaboration.

    Original Paper Text:
    """
    ${l}
    """

    Elaboration on "${t}":`,r=await O("",{...k,customPromptOverride:s});r.error?(a(`Error elaborating: ${r.error}`,"error"),p(`Failed to elaborate on "${t}".`)):(p(r.text),a(`Elaboration for "${t.substring(0,30)}..." ready.`,"success")),S(!1)},N=(t,s,r="Not provided.")=>t==null?`${s}: ${r}
`:typeof t=="string"?t.trim()===""?`${s}: ${r}
`:`${s}:
${t}
`:t.length===0?`${s}: None listed.
`:`${s}:
${t.map(d=>`- ${d}`).join(`
`)}
`,F=t=>{if(!t)return"No analysis data available.";let s=`Paper Analysis Report
=========================

`;return s+=`Summary:
${t.summary||"Not provided."}

`,s+=N(t.keyFindings,"Key Findings"),s+=`Methodology:
${t.methodology||"Not described."}

`,s+=N(t.limitations,"Limitations"),s+=N(t.identifiedGaps,"Identified Research Gaps","No specific gaps highlighted."),s+=N(t.suggestedFutureResearch,"Suggested Future Research","No specific future research suggestions provided or parsed."),g&&x&&(s+=`
Elaboration on "${x}":
${g}
`),s},z=(t,s)=>{const r=t.replace(/[^\w\s-]/gi,"").replace(/\s+/g,"_")||"PaperAnalysis";return`${_} - PaperAnalyzer - ${r}.${s}`},D=()=>{if(!i){a("No analysis to download.","info");return}const t=F(i),s=z(A||"Analysis","txt");Q(t,s),a("Analysis download initiated.","success")},M=()=>{if(!i){a("No analysis to save.","info");return}const t=F(i),s=z(A||"Analysis","txt");T(t,s)},L=()=>{j(""),f(null),u(null),p(null),v(null),P(void 0),a("Input and analysis cleared.","info")},I=(t,s,r="Not provided.")=>t==null?e.jsx("p",{className:"text-muted-foreground dark:text-dark-muted-foreground",children:r}):typeof t=="string"?t.trim()===""?e.jsx("p",{className:"text-muted-foreground dark:text-dark-muted-foreground",children:r}):e.jsx("p",{className:"whitespace-pre-wrap",children:t}):t.length===0?e.jsx("p",{className:"text-muted-foreground dark:text-dark-muted-foreground",children:"None listed."}):e.jsx("ul",{className:"list-disc list-inside space-y-1",children:t.map((d,B)=>e.jsxs("li",{className:"flex items-start justify-between group",children:[e.jsx("span",{children:d}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>E(d),className:"ml-2 p-1 opacity-50 group-hover:opacity-100 transition-opacity text-primary dark:text-dark-primary hover:bg-primary/10 dark:hover:bg-dark-primary/20",title:`Dig deeper into: ${d.substring(0,50)}...`,disabled:y&&x===d,children:y&&x===d?e.jsx(w,{size:"sm"}):e.jsx(V,{className:"h-4 w-4"})})]},`${s}-${B}`))}),R=(t,s="Not provided.")=>t==null?e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:s}):typeof t=="string"?t.trim()===""?e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:s}):e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground whitespace-pre-wrap",children:t}):t.length===0?e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:"None listed."}):e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground dark:text-dark-muted-foreground",children:t.map((r,d)=>e.jsx("li",{children:r},d))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"pb-4",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight text-foreground dark:text-dark-foreground flex items-center",children:[e.jsx(C,{className:"h-7 w-7 md:h-8 md:w-8 mr-2 text-primary dark:text-dark-primary"}),"Paper Analyzer"]}),e.jsx("p",{className:"mt-1 text-muted-foreground dark:text-dark-muted-foreground",children:"Get a detailed AI-powered analysis of any research paper."})]}),e.jsxs(h,{title:"Paste Research Paper Text",children:[e.jsx("textarea",{value:l,onChange:t=>j(t.target.value),rows:12,className:"w-full p-2.5 border rounded-md focus:ring-2 focus:ring-primary dark:focus:ring-dark-primary focus:border-transparent bg-background dark:bg-dark-input dark:border-dark-border dark:text-dark-foreground dark:placeholder-dark-muted-foreground transition-all",placeholder:"Paste the abstract, introduction, or full text of a research paper here...","aria-label":"Research paper text input"}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx(m,{onClick:L,variant:"outline",disabled:c,className:"w-full sm:w-auto",children:"Clear All"}),e.jsx(m,{onClick:G,isLoading:c,disabled:!l.trim(),className:"w-full sm:w-auto",children:"Analyze Paper"})]})]}),e.jsxs("div",{"aria-live":"polite","aria-busy":c||y,children:[c&&e.jsx(w,{text:"Analyzing paper for key insights..."}),b&&!c&&e.jsxs(h,{className:"bg-destructive/10 border-destructive text-destructive-foreground dark:bg-destructive/20 dark:text-destructive",children:[e.jsx("p",{className:"font-semibold",children:"Error Analyzing Paper"}),e.jsx("p",{className:"text-sm",children:b})]}),!c&&!i&&!b&&!l.trim()&&e.jsx(h,{children:e.jsxs("div",{className:"text-center py-10 text-muted-foreground dark:text-dark-muted-foreground",children:[e.jsx(C,{className:"h-16 w-16 mx-auto text-primary/30 dark:text-dark-primary/30 mb-4"}),e.jsx("p",{className:"font-semibold text-lg",children:"Ready to Analyze"}),e.jsx("p",{className:"text-sm",children:"Paste your paper text above to receive a structured analysis."})]})}),!c&&i&&e.jsxs(h,{title:"Paper Analysis",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-2 mb-4 -mt-2",children:[e.jsx(m,{onClick:D,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:"Download Analysis"}),e.jsx(m,{onClick:M,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:"Save to Google Drive"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Summary"}),e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground whitespace-pre-wrap",children:i.summary||"Not provided."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:"Key Findings"}),I(i.keyFindings,"finding")]}),g&&e.jsx(h,{title:`Elaboration on: "${x}"`,className:"my-3 bg-primary/5 dark:bg-dark-primary/10",children:y?e.jsx(w,{size:"sm"}):e.jsx("p",{className:"text-sm whitespace-pre-line",children:g})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:"Methodology"}),e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground whitespace-pre-wrap",children:i.methodology||"Not described."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:"Limitations"}),I(i.limitations,"limitation")]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:"Identified Research Gaps"}),R(i.identifiedGaps,"No specific gaps highlighted.")]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:"Suggested Future Research"}),R(i.suggestedFutureResearch,"No specific future research suggestions provided.")]}),e.jsx("div",{className:"pt-2 flex justify-end",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground dark:text-dark-muted-foreground mr-1",children:"Helpful?"}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{a("Feedback recorded (mock).","info")},className:"p-1 text-muted-foreground hover:text-primary",children:e.jsx(U,{})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{a("Feedback recorded (mock).","info")},className:"p-1 text-muted-foreground hover:text-destructive",children:e.jsx(W,{})})]})})]})]})]})]})};export{re as default};
