import{l as B,o as K,q as Y,m as _,r as n,j as e,g as C,c as u,t as w,S as q,a as H}from"./index-Cf9C7PVC.js";import{C as f}from"./Card-C8Vt2KLr.js";import{g as E,p as U}from"./geminiService-DJIPhCmJ.js";import{d as W}from"./downloadHelper-Y0t7dfPR.js";import{T as Q,a as V}from"./ThumbsDownIcon-DnGwiL1i.js";const se=()=>{const{settings:b}=B(),i=K(),{addToast:a}=Y(),{openSaveToDriveModal:O}=_(),[l,j]=n.useState(""),[o,g]=n.useState(null),[c,A]=n.useState(!1),[k,p]=n.useState(null),[$,S]=n.useState(void 0),[h,m]=n.useState(null),[y,P]=n.useState(!1),[x,v]=n.useState(null);n.useEffect(()=>{var t;if((t=i.state)!=null&&t.initialText){j(i.state.initialText),i.state.documentName&&S(i.state.documentName);const r=i.state.documentName?` from "${i.state.documentName}"`:"",s=i.state.sourceFeatureName?` from ${i.state.sourceFeatureName}`:"";a(`Text loaded${s}${r} into Paper Analyzer.`,"info"),window.history.replaceState({},document.title)}},[i.state,a]);const R=n.useCallback(async()=>{if(!l.trim()){p("Please paste the text of the research paper to analyze."),a("Please paste paper text.","warning");return}A(!0),p(null),g(null),m(null),v(null);const t=`You are an expert academic paper analyzer. Analyze the following research paper text.
Please provide a structured analysis in JSON format with the following keys:
- "summary": A concise summary of the paper (around 200-300 words), covering purpose, methods, key findings, and conclusions.
- "keyFindings": A bulleted list of the main findings or results (3-5 key points). If providing a list, use an array of strings.
- "methodology": A brief description of the methodology used in the research (1-2 paragraphs), including design, participants/sample, and data collection tools/procedures.
- "limitations": A bulleted list of limitations identified by the authors or apparent from the text (2-4 key points). If providing a list, use an array of strings.
- "identifiedGaps": A bulleted list or a short paragraph describing any research gaps explicitly mentioned or strongly implied by the authors that their research addresses or that remain. If providing a list, use an array of strings. If none clearly identified, state so.
- "suggestedFutureResearch": Based on the paper's findings and limitations, suggest 1-2 potential avenues for future research. If providing a list, use an array of strings.

Ensure the output is ONLY a valid JSON object. Do not include any explanatory text before or after the JSON.

Paper Text:
"""
${l}
"""`,r=await E("",{...b,responseMimeType:"application/json",customPromptOverride:t});if(r.error)p(r.error),a(r.error,"error");else{const s=U(r.text);s?(g(s),a("Paper analysis complete with detailed insights!","success")):(p("AI returned data in an unexpected format. Could not parse analysis. Displaying raw output if available."),a("Failed to parse AI response into structured analysis.","error"),g({summary:`Raw AI Output (JSON parsing failed):
`+r.text,keyFindings:[],methodology:"",limitations:[],identifiedGaps:"Could not parse from AI response.",suggestedFutureResearch:"Could not parse from AI response."}))}A(!1)},[l,b,a]),D=async t=>{if(!l.trim()){a("Original paper text is missing for elaboration.","warning");return}P(!0),v(t),m(null);const r=`Based on the original paper text provided below, please elaborate on the following specific point: "${t}". Provide a more detailed explanation, context, or implications related to this point as found in or directly derivable from the paper.
    Output only the elaboration.

    Original Paper Text:
    """
    ${l}
    """

    Elaboration on "${t}":`,s=await E("",{...b,customPromptOverride:r});s.error?(a(`Error elaborating: ${s.error}`,"error"),m(`Failed to elaborate on "${t}".`)):(m(s.text),a(`Elaboration for "${t.substring(0,30)}..." ready.`,"success")),P(!1)},N=(t,r,s="Not provided.")=>t==null?`${r}: ${s}
`:typeof t=="string"?t.trim()===""?`${r}: ${s}
`:`${r}:
${t}
`:t.length===0?`${r}: None listed.
`:`${r}:
${t.map(d=>`- ${d}`).join(`
`)}
`,F=t=>{if(!t)return"No analysis data available.";let r=`Paper Analysis Report
=========================

`;return r+=`Summary:
${t.summary||"Not provided."}

`,r+=N(t.keyFindings,"Key Findings"),r+=`Methodology:
${t.methodology||"Not described."}

`,r+=N(t.limitations,"Limitations"),r+=N(t.identifiedGaps,"Identified Research Gaps","No specific gaps highlighted."),r+=N(t.suggestedFutureResearch,"Suggested Future Research","No specific future research suggestions provided or parsed."),h&&x&&(r+=`
Elaboration on "${x}":
${h}
`),r},I=(t,r)=>{const s=t.replace(/[^\w\s-]/gi,"").replace(/\s+/g,"_")||"PaperAnalysis";return`${H} - PaperAnalyzer - ${s}.${r}`},G=()=>{if(!o){a("No analysis to download.","info");return}const t=F(o),r=I($||"Analysis","txt");W(t,r),a("Analysis download initiated.","success")},L=()=>{if(!o){a("No analysis to save.","info");return}const t=F(o),r=I($||"Analysis","txt");O(t,r)},M=()=>{j(""),g(null),p(null),m(null),v(null),S(void 0),a("Input and analysis cleared.","info")},z=(t,r,s="Not provided.")=>t==null?e.jsx("p",{className:"text-muted-foreground dark:text-dark-muted-foreground",children:s}):typeof t=="string"?t.trim()===""?e.jsx("p",{className:"text-muted-foreground dark:text-dark-muted-foreground",children:s}):e.jsx("p",{className:"whitespace-pre-wrap",children:t}):t.length===0?e.jsx("p",{className:"text-muted-foreground dark:text-dark-muted-foreground",children:"None listed."}):e.jsx("ul",{className:"list-disc list-inside space-y-1",children:t.map((d,J)=>e.jsxs("li",{className:"flex items-start justify-between group",children:[e.jsx("span",{children:d}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>D(d),className:"ml-2 p-1 opacity-50 group-hover:opacity-100 transition-opacity text-primary dark:text-dark-primary hover:bg-primary/10 dark:hover:bg-dark-primary/20",title:`Dig deeper into: ${d.substring(0,50)}...`,disabled:y&&x===d,children:y&&x===d?e.jsx(w,{size:"sm"}):e.jsx(q,{className:"h-4 w-4"})})]},`${r}-${J}`))}),T=(t,r="Not provided.")=>t==null?e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:r}):typeof t=="string"?t.trim()===""?e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:r}):e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground whitespace-pre-wrap",children:t}):t.length===0?e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:"None listed."}):e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground dark:text-dark-muted-foreground",children:t.map((s,d)=>e.jsx("li",{children:s},d))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"pb-4",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight text-foreground dark:text-dark-foreground flex items-center",children:[e.jsx(C,{className:"h-7 w-7 md:h-8 md:w-8 mr-2 text-primary dark:text-dark-primary"}),"Paper Analyzer"]}),e.jsx("p",{className:"mt-1 text-muted-foreground dark:text-dark-muted-foreground",children:"Get a detailed AI-powered analysis of any research paper."})]}),e.jsxs(f,{title:"Paste Research Paper Text",children:[e.jsx("textarea",{value:l,onChange:t=>j(t.target.value),rows:12,className:"w-full p-2.5 border rounded-md focus:ring-2 focus:ring-primary dark:focus:ring-dark-primary focus:border-transparent bg-background dark:bg-dark-input dark:border-dark-border dark:text-dark-foreground dark:placeholder-dark-muted-foreground transition-all",placeholder:"Paste the abstract, introduction, or full text of a research paper here...","aria-label":"Research paper text input"}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx(u,{onClick:M,variant:"outline",disabled:c,className:"w-full sm:w-auto",children:"Clear All"}),e.jsx(u,{onClick:R,isLoading:c,disabled:!l.trim(),className:"w-full sm:w-auto",children:"Analyze Paper"})]})]}),e.jsxs("div",{"aria-live":"polite","aria-busy":c||y,children:[c&&e.jsx(w,{text:"Analyzing paper for key insights..."}),k&&!c&&e.jsxs(f,{className:"bg-destructive/10 border-destructive text-destructive-foreground dark:bg-destructive/20 dark:text-destructive",children:[e.jsx("p",{className:"font-semibold",children:"Error Analyzing Paper"}),e.jsx("p",{className:"text-sm",children:k})]}),!c&&!o&&!k&&!l.trim()&&e.jsx(f,{children:e.jsxs("div",{className:"text-center py-10 text-muted-foreground dark:text-dark-muted-foreground",children:[e.jsx(C,{className:"h-16 w-16 mx-auto text-primary/30 dark:text-dark-primary/30 mb-4"}),e.jsx("p",{className:"font-semibold text-lg",children:"Ready to Analyze"}),e.jsx("p",{className:"text-sm",children:"Paste your paper text above to receive a structured analysis."})]})}),!c&&o&&e.jsxs(f,{title:"Paper Analysis",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-2 mb-4 -mt-2",children:[e.jsx(u,{onClick:G,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:"Download Analysis"}),e.jsx(u,{onClick:L,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:"Save to Google Drive"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Summary"}),e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground whitespace-pre-wrap",children:o.summary||"Not provided."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:"Key Findings"}),z(o.keyFindings,"finding")]}),h&&e.jsx(f,{title:`Elaboration on: "${x}"`,className:"my-3 bg-primary/5 dark:bg-dark-primary/10",children:y?e.jsx(w,{size:"sm"}):e.jsx("p",{className:"text-sm whitespace-pre-line",children:h})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:"Methodology"}),e.jsx("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground whitespace-pre-wrap",children:o.methodology||"Not described."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:"Limitations"}),z(o.limitations,"limitation")]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:"Identified Research Gaps"}),T(o.identifiedGaps,"No specific gaps highlighted.")]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:"Suggested Future Research"}),T(o.suggestedFutureResearch,"No specific future research suggestions provided.")]}),e.jsx("div",{className:"pt-2 flex justify-end",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground dark:text-dark-muted-foreground mr-1",children:"Helpful?"}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>{a("Feedback recorded (mock).","info")},className:"p-1 text-muted-foreground hover:text-primary",children:e.jsx(Q,{})}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>{a("Feedback recorded (mock).","info")},className:"p-1 text-muted-foreground hover:text-destructive",children:e.jsx(V,{})})]})})]})]})]})]})};export{se as default};
