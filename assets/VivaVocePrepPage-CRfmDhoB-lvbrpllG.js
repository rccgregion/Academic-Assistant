import{f as T,h as E,y as D,m as I,v as i,u as t,q as P,a as p,l as O,r as Y,d as G}from"./index-CL7HjhdV.js";import{b as h}from"./Card-C8Vt2KLr-CXW7Tvcj.js";import{a as M,c as z}from"./geminiService-DJIPhCmJ-Bm2owfCC.js";import{c as B}from"./downloadHelper-Y0t7dfPR--lPmL3re.js";const L=()=>{const{settings:j}=T(),n=E(),{addToast:s}=D(),{openSaveToDriveModal:Q}=I(),[d,f]=i.useState(""),[o,u]=i.useState([]),[c,b]=i.useState(!1),[x,l]=i.useState(null),[g,w]=i.useState(void 0),[v,y]=i.useState({});i.useEffect(()=>{var r;if((r=n.state)!=null&&r.initialText){f(n.state.initialText),n.state.documentName&&w(n.state.documentName);const e=n.state.documentName?` from "${n.state.documentName}"`:"";s(`Project text loaded${e} for Viva Voce Prep.`,"info"),window.history.replaceState({},document.title)}},[n.state,s]);const $=i.useCallback(async()=>{if(!d.trim()){l("Please paste your project text to generate Q&A."),s("Project text is empty.","warning");return}b(!0),l(null),u([]),y({});const r=`You are an experienced academic supervisor preparing a student for their viva voce (project defense).
Based on the following project text, generate at least 20 potential questions that a supervisor or examiner might ask during the defense.
For each question, provide a concise, well-reasoned, and insightful answer that the student could use as a basis for their response.
Cover various aspects such as:
-   Methodology (justification, limitations)
-   Key findings (significance, interpretation)
-   Contribution to knowledge
-   Theoretical underpinnings
-   Practical implications
-   Potential weaknesses or criticisms
-   Future research directions

Output the result as a single JSON array of objects. Each object should have two keys: "question" (string) and "answer" (string).
Example of one object:
{
  "question": "What was the primary motivation behind choosing this specific research methodology?",
  "answer": "The primary motivation for selecting [Methodology Name, e.g., a qualitative case study approach] was its suitability for in-depth exploration of [Your Topic's Core Aspect]. This methodology allowed for [Specific Benefit 1, e.g., rich, contextual data collection] and [Specific Benefit 2, e.g., understanding nuanced perspectives] which were crucial for addressing the research questions effectively. While quantitative methods could provide breadth, this approach offered the necessary depth to uncover [Key Insight or Phenomenon]."
}

Project Text:
"""
${d}
"""

Ensure the output is ONLY a valid JSON array.`,e=await M("",{...j,responseMimeType:"application/json",customPromptOverride:r});if(e.error)l(e.error),s(e.error,"error");else{const a=z(e.text);a&&Array.isArray(a)&&a.every(m=>typeof m.question=="string"&&typeof m.answer=="string")?(u(a),s(`${a.length} Q&A pairs generated!`,"success")):(l("AI returned data in an unexpected format. Could not parse Q&A. Displaying raw output if available."),s("Failed to parse AI response into structured Q&A.","error"),u([{question:"Error Parsing Response",answer:"AI output was not valid JSON. Raw: "+e.text}]))}b(!1)},[d,j,s]),k=r=>{y(e=>({...e,[r]:!e[r]}))},q=(r,e)=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),k(e))},N=r=>{let e=`Viva Voce Preparation Q&A
Project: ${g||"Untitled Project"}
====================================

`;return r.forEach((a,m)=>{e+=`Question ${m+1}: ${a.question}
`,e+=`Answer:
${a.answer}

`,e+=`------------------------------------

`}),e},A=(r,e)=>{const a=r.replace(/[^\w\s-]/gi,"").replace(/\s+/g,"_")||"VivaPrep";return`${G} - VivaVocePrep - ${a}.${e}`},V=()=>{if(o.length===0){s("No Q&A to download.","info");return}const r=N(o),e=A(g||"Q&A","txt");B(r,e),s("Q&A download initiated.","success")},S=()=>{if(o.length===0){s("No Q&A to save.","info");return}const r=N(o),e=A(g||"Q&A","txt");Q(r,e)},C=()=>{f(""),u([]),l(null),y({}),w(void 0),s("Input and Q&A cleared.","info")};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("header",{className:"pb-4",children:[t.jsxs("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight text-foreground dark:text-dark-foreground flex items-center",children:[t.jsx(P,{className:"h-7 w-7 md:h-8 md:w-8 mr-2 text-primary dark:text-dark-primary"}),"Viva Voce Prep"]}),t.jsx("p",{className:"mt-1 text-muted-foreground dark:text-dark-muted-foreground",children:"Generate potential viva voce (project defense) questions and answers based on your project text."})]}),t.jsxs(h,{title:"Input Your Project Text",children:[t.jsx("textarea",{value:d,onChange:r=>f(r.target.value),rows:15,className:"w-full p-2.5 border rounded-md focus:ring-2 focus:ring-primary dark:focus:ring-dark-primary focus:border-transparent bg-background dark:bg-dark-input dark:border-dark-border dark:text-dark-foreground dark:placeholder-dark-muted-foreground transition-all",placeholder:"Paste the core text of your project/thesis here (e.g., abstract, introduction, key chapters, conclusion)...","aria-label":"Project text input for Viva Voce Prep"}),t.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-2",children:[(d||o.length>0)&&t.jsx(p,{onClick:C,variant:"outline",disabled:c,className:"w-full sm:w-auto",children:"Clear All"}),t.jsx(p,{onClick:$,isLoading:c,disabled:!d.trim(),className:"w-full sm:w-auto",children:"Generate Q&A"})]})]}),t.jsxs("div",{"aria-live":"polite","aria-busy":c,children:[c&&t.jsx(O,{text:"Preparing your defense questions & answers..."}),x&&!c&&t.jsxs(h,{className:"bg-destructive/10 border-destructive text-destructive-foreground dark:bg-destructive/20 dark:text-destructive",children:[t.jsx("p",{className:"font-semibold",children:"Error Generating Q&A"}),t.jsx("p",{className:"text-sm",children:x})]}),!c&&!o.length&&!x&&!d.trim()&&t.jsx(h,{children:t.jsxs("div",{className:"text-center py-10 text-muted-foreground dark:text-dark-muted-foreground",children:[t.jsx(P,{className:"h-16 w-16 mx-auto text-primary/30 dark:text-dark-primary/30 mb-4"}),t.jsx("p",{className:"font-semibold text-lg",children:"Ready to Prep for Your Viva"}),t.jsx("p",{className:"text-sm",children:"Paste your project text above to generate potential Q&A."})]})}),!c&&o.length>0&&t.jsxs(h,{title:"Generated Viva Voce Q&A",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-end items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-2 mb-4 -mt-2",children:[t.jsx(p,{onClick:V,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:"Download Q&A"}),t.jsx(p,{onClick:S,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:"Save Q&A to Google Drive"})]}),t.jsx("div",{className:"space-y-3",children:o.map((r,e)=>t.jsxs("div",{className:"border border-border dark:border-dark-border rounded-md",children:[t.jsxs("button",{onClick:()=>k(e),onKeyDown:a=>q(a,e),className:"w-full flex justify-between items-center p-3 text-left text-sm font-medium text-foreground dark:text-dark-foreground hover:bg-muted/50 dark:hover:bg-dark-muted/30 focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-dark-primary rounded-t-md","aria-expanded":v[e]||!1,"aria-controls":`answer-${e}`,children:[t.jsxs("span",{children:[t.jsxs("strong",{children:["Q",e+1,":"]})," ",r.question]}),t.jsx(Y,{className:`h-5 w-5 transform transition-transform duration-200 ${v[e]?"rotate-180":""}`})]}),v[e]&&t.jsx("div",{id:`answer-${e}`,role:"region","aria-labelledby":`question-${e}`,className:"p-3 border-t border-border dark:border-dark-border bg-background dark:bg-dark-card rounded-b-md",children:t.jsxs("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground whitespace-pre-line",children:[t.jsx("strong",{children:"Answer:"})," ",r.answer]})})]},e))})]})]})]})};export{L as default};
