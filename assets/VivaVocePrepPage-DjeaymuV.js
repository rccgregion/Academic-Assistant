import{l as $,o as D,q as E,m as I,r as n,j as t,i as P,c as p,t as G,x as O,a as B}from"./index-DwfKsHWR.js";import{C as f}from"./Card-BP-gc27O.js";import{g as F,p as M}from"./geminiService-BkXzVexN.js";import{d as Y}from"./downloadHelper-Y0t7dfPR.js";const z=()=>{const{settings:w}=$(),i=D(),{addToast:s}=E(),{openSaveToDriveModal:Q}=I(),[c,h]=n.useState(""),[o,u]=n.useState([]),[d,y]=n.useState(!1),[x,l]=n.useState(null),[g,b]=n.useState(void 0),[v,j]=n.useState({});n.useEffect(()=>{var r;if((r=i.state)!=null&&r.initialText){h(i.state.initialText),i.state.documentName&&b(i.state.documentName);const e=i.state.documentName?` from "${i.state.documentName}"`:"";s(`Project text loaded${e} for Viva Voce Prep.`,"info"),window.history.replaceState({},document.title)}},[i.state,s]);const S=n.useCallback(async()=>{if(!c.trim()){l("Please paste your project text to generate Q&A."),s("Project text is empty.","warning");return}y(!0),l(null),u([]),j({});const r=`You are an experienced academic supervisor preparing a student for their viva voce (project defense).
Based on the following project text, generate at least 20 potential questions that a supervisor or examiner might ask during the defense.
For each question, provide a concise, well-reasoned, and insightful answer that the student could use as a basis for their response.
Cover various aspects such as:
-   Methodology (justification, limitations)
-   Key findings (significance, interpretation)
-   Contribution to knowledge
-   Theoretical underpinnings
-   Practical implications
-   Potential weaknesses or criticisms
-   Future research directions

Output the result as a single JSON array of objects. Each object should have two keys: "question" (string) and "answer" (string).
Example of one object:
{
  "question": "What was the primary motivation behind choosing this specific research methodology?",
  "answer": "The primary motivation for selecting [Methodology Name, e.g., a qualitative case study approach] was its suitability for in-depth exploration of [Your Topic's Core Aspect]. This methodology allowed for [Specific Benefit 1, e.g., rich, contextual data collection] and [Specific Benefit 2, e.g., understanding nuanced perspectives] which were crucial for addressing the research questions effectively. While quantitative methods could provide breadth, this approach offered the necessary depth to uncover [Key Insight or Phenomenon]."
}

Project Text:
"""
${c}
"""

Ensure the output is ONLY a valid JSON array.`,e=await F("",{...w,responseMimeType:"application/json",customPromptOverride:r});if(e.error)l(e.error),s(e.error,"error");else{const a=M(e.text);a&&Array.isArray(a)&&a.every(m=>typeof m.question=="string"&&typeof m.answer=="string")?(u(a),s(`${a.length} Q&A pairs generated!`,"success")):(l("AI returned data in an unexpected format. Could not parse Q&A. Displaying raw output if available."),s("Failed to parse AI response into structured Q&A.","error"),u([{question:"Error Parsing Response",answer:"AI output was not valid JSON. Raw: "+e.text}]))}y(!1)},[c,w,s]),k=r=>{j(e=>({...e,[r]:!e[r]}))},T=(r,e)=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),k(e))},N=r=>{let e=`Viva Voce Preparation Q&A
Project: ${g||"Untitled Project"}
====================================

`;return r.forEach((a,m)=>{e+=`Question ${m+1}: ${a.question}
`,e+=`Answer:
${a.answer}

`,e+=`------------------------------------

`}),e},A=(r,e)=>{const a=r.replace(/[^\w\s-]/gi,"").replace(/\s+/g,"_")||"VivaPrep";return`${B} - VivaVocePrep - ${a}.${e}`},C=()=>{if(o.length===0){s("No Q&A to download.","info");return}const r=N(o),e=A(g||"Q&A","txt");Y(r,e),s("Q&A download initiated.","success")},q=()=>{if(o.length===0){s("No Q&A to save.","info");return}const r=N(o),e=A(g||"Q&A","txt");Q(r,e)},V=()=>{h(""),u([]),l(null),j({}),b(void 0),s("Input and Q&A cleared.","info")};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("header",{className:"pb-4",children:[t.jsxs("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight text-foreground dark:text-dark-foreground flex items-center",children:[t.jsx(P,{className:"h-7 w-7 md:h-8 md:w-8 mr-2 text-primary dark:text-dark-primary"}),"Viva Voce Prep"]}),t.jsx("p",{className:"mt-1 text-muted-foreground dark:text-dark-muted-foreground",children:"Generate potential viva voce (project defense) questions and answers based on your project text."})]}),t.jsxs(f,{title:"Input Your Project Text",children:[t.jsx("textarea",{value:c,onChange:r=>h(r.target.value),rows:15,className:"w-full p-2.5 border rounded-md focus:ring-2 focus:ring-primary dark:focus:ring-dark-primary focus:border-transparent bg-background dark:bg-dark-input dark:border-dark-border dark:text-dark-foreground dark:placeholder-dark-muted-foreground transition-all",placeholder:"Paste the core text of your project/thesis here (e.g., abstract, introduction, key chapters, conclusion)...","aria-label":"Project text input for Viva Voce Prep"}),t.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-2",children:[(c||o.length>0)&&t.jsx(p,{onClick:V,variant:"outline",disabled:d,className:"w-full sm:w-auto",children:"Clear All"}),t.jsx(p,{onClick:S,isLoading:d,disabled:!c.trim(),className:"w-full sm:w-auto",children:"Generate Q&A"})]})]}),t.jsxs("div",{"aria-live":"polite","aria-busy":d,children:[d&&t.jsx(G,{text:"Preparing your defense questions & answers..."}),x&&!d&&t.jsxs(f,{className:"bg-destructive/10 border-destructive text-destructive-foreground dark:bg-destructive/20 dark:text-destructive",children:[t.jsx("p",{className:"font-semibold",children:"Error Generating Q&A"}),t.jsx("p",{className:"text-sm",children:x})]}),!d&&!o.length&&!x&&!c.trim()&&t.jsx(f,{children:t.jsxs("div",{className:"text-center py-10 text-muted-foreground dark:text-dark-muted-foreground",children:[t.jsx(P,{className:"h-16 w-16 mx-auto text-primary/30 dark:text-dark-primary/30 mb-4"}),t.jsx("p",{className:"font-semibold text-lg",children:"Ready to Prep for Your Viva"}),t.jsx("p",{className:"text-sm",children:"Paste your project text above to generate potential Q&A."})]})}),!d&&o.length>0&&t.jsxs(f,{title:"Generated Viva Voce Q&A",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-end items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-2 mb-4 -mt-2",children:[t.jsx(p,{onClick:C,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:"Download Q&A"}),t.jsx(p,{onClick:q,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:"Save Q&A to Google Drive"})]}),t.jsx("div",{className:"space-y-3",children:o.map((r,e)=>t.jsxs("div",{className:"border border-border dark:border-dark-border rounded-md",children:[t.jsxs("button",{onClick:()=>k(e),onKeyDown:a=>T(a,e),className:"w-full flex justify-between items-center p-3 text-left text-sm font-medium text-foreground dark:text-dark-foreground hover:bg-muted/50 dark:hover:bg-dark-muted/30 focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-dark-primary rounded-t-md","aria-expanded":v[e]||!1,"aria-controls":`answer-${e}`,children:[t.jsxs("span",{children:[t.jsxs("strong",{children:["Q",e+1,":"]})," ",r.question]}),t.jsx(O,{className:`h-5 w-5 transform transition-transform duration-200 ${v[e]?"rotate-180":""}`})]}),v[e]&&t.jsx("div",{id:`answer-${e}`,role:"region","aria-labelledby":`question-${e}`,className:"p-3 border-t border-border dark:border-dark-border bg-background dark:bg-dark-card rounded-b-md",children:t.jsxs("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground whitespace-pre-line",children:[t.jsx("strong",{children:"Answer:"})," ",r.answer]})})]},e))})]})]})]})};export{z as default};
